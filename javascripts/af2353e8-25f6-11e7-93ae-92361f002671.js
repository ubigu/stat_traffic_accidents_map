"use strict";function getQueryParams(e){e=e.split("+").join(" ");for(var t,a={},r=/[?&]?([^=]+)=([^&]*)/g;t=r.exec(e);)a[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return a}function Language(lang){var __construct=function(){"undefined"==eval("typeof "+lang)&&(lang="fi")}();this.getStr=function(str,defaultStr){var retStr=eval("eval(lang)."+str);return"undefined"!=typeof retStr?retStr:"undefined"!=typeof defaultStr?defaultStr:eval("fi."+str)}}function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);var a=e.indexOf("Trident/");if(a>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0?parseInt(e.substring(n+5,e.indexOf(".",n)),10):!1}function stability(e){switch(e){case 1:return translator.getStr("lang_stability_1");case 2:return translator.getStr("lang_stability_2")}}function time(e){switch(e){case"K":return"Koko vuorokausi";case 1:return"06:00-09:00";case 2:return"09:00-12:00";case 3:return"12:00-15:00";case 4:return"15:00-18:00";case 5:return"18:00-21:00";case 6:return"21:00-00:00";case 7:return"00:00-03:00";case 8:return"03:00-06:00"}}function timeClauses(e){switch(e){case 1:return"'06.00-06.59', '07.00-07.59', '08.00-08.59'";case 2:return"'09.00-09.59', '10.00-10.59', '11.00-11.59'";case 3:return"'12.00-12.59', '13.00-13.59', '14.00-14.59'";case 4:return"'15.00-15.59', '16.00-16.59', '17.00-17.59'";case 5:return"'18.00-18.59', '19.00-19.59', '20.00-20.59'";case 6:return"'21.00-21.59', '22.00-22.59', '23.00-23.59'";case 7:return"'00.00-00.59', '01.00-01.59', '02.00-02.59'";case 8:return"'03.00-03.59', '04.00-04.59', '05.00-05.59'"}}function typeCodes(e){var t;for(t=0;10>t;t++)switch(e){case t:return translator.getStr("lang_type_"+t)}}function accessoryCodes(e){var t;for(t=0;10>t;t++)switch(e){case t:return translator.getStr("lang_partakers_"+t)}}function populateFormSelects(){var e,t,a=[],r=[];for(e=0;10>e;e++)a.push(translator.getStr("lang_type_"+e));for(t=0;7>t;t++)r.push(translator.getStr("lang_partakers_"+t));var n=[translator.getStr("lang_stability_1"),translator.getStr("lang_stability_2")];$("#vakavuus").empty(),$("#tyyppi").empty(),$("#osalliset").empty(),$.each(n,function(e,t){$("#vakavuus").append($('<option value="'+e+'1"></option>').val(e+1).html(t))}),$.each(a,function(e,t){$("#tyyppi").append($('<option value="'+e+'"></option>').val(e).html(t))}),$.each(r,function(e,t){$("#osalliset").append($('<option value="'+e+'"></option>').val(e).html(t))})}function createClusterIcon(e){if(!e.get("cluster")){var t,a=get_colors(),r="",n=$("#year").val();for(t=0;t<n.length;t++)e.get("vvonn")==n[t]&&(r=a[t]);var o=new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:r})}),i={Point:new ol.style.Style({image:o}),MultiPoint:new ol.style.Style({image:o}),Circle:new ol.style.Style({stroke:new ol.style.Stroke({color:"green",width:2}),fill:new ol.style.Fill({color:"rgba(0,255,0,0.2)"})})};return i[e.getGeometry().getType()]}return e.get("point_count")>1e3?(circle1.getImage().setRadius(50),circle1.getText().setText(""+e.get("point_count")),circle1):e.get("point_count")>=500&&e.get("point_count")<=999?(circle2.getImage().setRadius(40),circle2.getText().setText(""+e.get("point_count")),circle2):e.get("point_count")>=100&&e.get("point_count")<=499?(circle3.getImage().setRadius(30),circle3.getText().setText(""+e.get("point_count")),circle3):e.get("point_count")>=50&&e.get("point_count")<=99?(circle4.getImage().setRadius(20),circle4.getText().setText(""+e.get("point_count")),circle4):e.get("point_count")>=2&&e.get("point_count")<=49?(circle5.getImage().setRadius(15),circle5.getText().setText(""+e.get("point_count")),circle5):void 0}function changeParameter(e,t,a,r,n,o,i){var l="",s="",c="";if(console.log(o),"K"!=e);else;l=null!=r?"and vakav in ("+r+") ":"",s=null!=n?"and onntyyppi in ("+n+") ":"",null!=i?($.inArray("0",i)>=0&&(c+="and lkmhapa > 0 "),$.inArray("1",i)>=0&&(c+="and lkmlaka > 0 "),$.inArray("2",i)>=0&&(c+="and lkmjk > 0 "),$.inArray("3",i)>=0&&(c+="and lkmpp > 0 "),$.inArray("4",i)>=0&&(c+="and lkmmo > 0 "),$.inArray("5",i)>=0&&(c+="and lkmmp > 0 "),$.inArray("6",i)>=0&&(c+="and lkmmuukulk > 0 ")):c="",cqlFilter=[],years=[];var d,g="",u="",p="";if(null!=o){for(d=0;d<o.length;d++){var h=o[d];p+=timeClauses(parseInt(h))+","}u="and kello in ("+p.slice(0,-1)+")"}else u="";for(d=0;d<e.length;d++)g+="tieliikenne:tieliikenne_"+e[d]+",",years.push(e[d]);var m=g.slice(0,-1),y="https://www.webigu.fi/geoserver/tieliikenne/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+m+"&outputformat=text/javascript&format_options=callback:xhr&srsName=EPSG:4326&cql_filter=kkonn >="+t+" and kkonn <="+a+" "+l+" "+s+" "+c+" "+u;$(".loading").show(),loadWorkerParams(y,detectIE(),years)}function initRoute(e,t,a){if(1==a){if(0==t){var r=utils.to4326(e.coordinate);utils.createFeature(r)}if(1==t){var r=e;utils.createFeature(r),map.getView().setZoom(14),console.log(utils.to3857(e)),map.getView().setCenter(utils.to3857(e))}var n=points[points.length-1],o=points.push(r),i=turf.truncate(turf.point(r));if(1==o?(0==t&&$("#search_field").val(i.geometry.coordinates),searchToggle=1,$("#popupPanel-closerSideContentGraph").show(),$("#myChartDiv").hide(),$("#layerContent").hide(),$("#search_route_target").empty(),$("#searchContent").show(),$("#searchContent").append("<div id='searchContentContainer' class='container'>"),$("#searchContent").append("</div>"),$("#search_route_target").show(),$(".input-group").clone().appendTo("#search_route_target").find("input[type='text']").val(""),$("#search_route_target").find("form").attr("id","search_target"),$("#search_route_target").find("input").attr("placeholder",translator.getStr("lang_search_route2")),$("#search_route_target").find("input").attr("id","search_field_target"),$("#search_field_target").focus(),$(window).innerWidth()<=1366&&$(window).innerWidth()>640?$("#sideContentAnalysisHeader").css("height","156px"):$(window).innerWidth()<=640?$("#sideContentAnalysisHeader").css("height","150px"):$("#sideContentAnalysisHeader").css("height","193px"),$("#sideContentContentAnalysis").hide()):o>1&&0==t&&$("#search_field_target").val(i.geometry.coordinates),2>o)return void(msg_el.innerHTML=translator.getStr("route_endpoint"));var l=n.join(),s=r.join();fetch(url_mapbox_route+l+";"+s+".json?access_token=pk.eyJ1Ijoiam91a29qYXIiLCJhIjoiY2lvam1ubmVhMDA4Z3c0ajdleHl6ZjFtdSJ9.pbxTgzkFQJx-EMxxEJjSEA&overview=full").then(function(e){return e.json()}).then(function(e){if("Ok"!==e.code)return void(msg_el.innerHTML="Reittiä ei löytynyt.");var t=vectorSource.getFeatures();setTimeout(function(){utils.createRoute(e.routes[0].geometry)},1e3),t.length>0?($(".loading").show(),msg_el.innerHTML=translator.getStr("route_count")):(msg_el.innerHTML=translator.getStr("route_added"),$("#msg").fadeTo(5e3,0))})}else a=!1}function loadWorkerParams(e,t,a){var r=ol.proj.transformExtent(map.getView().calculateExtent(map.getSize()),"EPSG:3857","EPSG:4326");worker.postMessage({bbox:r,zoom:Math.round(map.getView().getZoom()),url:e,ie:t,years:a})}function update(){if(ready){var e=ol.proj.transformExtent(map.getView().calculateExtent(map.getSize()),"EPSG:3857","EPSG:4326");worker.postMessage({bbox:e,zoom:Math.round(map.getView().getZoom())})}}function countFeatures(){var e=map.getView().calculateExtent(),t=vectorSource.getFeaturesInExtent(e);return t.length}function prepareCharts(e){$("#source_1").hide(),monthArray2=[],sumTotal=[];for(var t=[],a=0;a<Object.keys(e).length;a++)monthArray2.push({label:Object.keys(e)[a],backgroundColor:colors_for_diagram[a],data:e[Object.keys(e)[a]]});if(e.map(function(e){for(var a=0;a<e.length;a++)t.length===e.length?t[a]=t[a]+e[a]:t.push(e[a])}),sumTotal=t.reduce(function(e,t){return e+t},0),""==myChart)loadChartMulti(monthArray2),myChart.update();else{myChart.data.datasets=monthArray2,myChart.update()}if("K"==$("#year").val())var r="Kaikki";else var r=$("#year").val();if("K"==$("#aika").val());else{time(parseInt($("#aika").val()))}var n="",o="",i="",l="",s=$("#vakavuus").val(),c=$("#tyyppi").val(),d=$("#aika").val(),g=$("#osalliset").val();if(null==s)for(var a=1;3>a;a++)n+=stability(parseInt(a))+"<br />";else for(var a=0;a<s.length;a++)n+=stability(parseInt(s[a]))+"<br />";if(null==c)for(var a=0;10>a;a++)o+=typeCodes(parseInt(a))+"<br />";else for(var a=0;a<c.length;a++)o+=typeCodes(parseInt(c[a]))+"<br />";if(null==d)for(var a=1;9>a;a++)i+=time(parseInt(a))+"<br />";else for(var a=0;a<d.length;a++)i+=time(parseInt(d[a]))+"<br />";if(null==g)l=translator.getStr("lang_partakers_no_selected");else for(var a=0;a<g.length;a++)l+=accessoryCodes(parseInt(g[a]))+"<br />";$("#sideContentContentAnalysis").hide(),$("#popupPanel-closerSideContentGraph").show(),$("#myChartDiv").show(),$("#myChart").show(),$("#myChartDivTopHeader").empty(),$("#myChartDivHeaderCol1").empty(),$("#myChartDivHeaderCol2").empty(),$("#myChartDivCenterHeader").empty(),$("#myChartDivFooter1").empty(),$("#myChartDivTopHeader").append(translator.getStr("lang_selected_filter_title")),$("#myChartDivHeaderCol1").append("<strong>"+translator.getStr("lang_year")+"</strong><hr />"+r+"<br /><br />"),$("#myChartDivHeaderCol1").append("<strong>"+translator.getStr("lang_time_of_day")+"</strong><hr />"+i+"<br />"),$("#myChartDivHeaderCol1").append("<strong>"+translator.getStr("lang_partakers")+"</strong><hr />"+l+"<br />"),$("#myChartDivHeaderCol2").append("<strong>"+translator.getStr("lang_stability")+"</strong><hr /> "+n+"<br />"),$("#myChartDivHeaderCol2").append("<strong>"+translator.getStr("lang_type")+"</strong><hr />"+o+"<br />"),$("#myChartDivCenterHeader").append(translator.getStr("lang_graph_title")),$("#myChartDivFooter1").append(translator.getStr("lang_sum_1")+sumTotal+translator.getStr("lang_sum_2"))}function initChart(e,t){for(var a=0;a<t.length;a++)prepareCharts(loadDataForChart(e,t[a]))}function loadDataForChart(e,t){var a=0;return monthArray=[0,0,0,0,0,0,0,0,0,0,0,0],$.each(e.features,function(e,r){if(r.properties.vvonn==t)for(var n=0;12>n;n++)r.properties.kkonn==n+1&&monthArray[n]++,n>a&&(yearArray[t]=monthArray,a=n)}),yearArray}function loadChartMulti(e){var t,a,r=document.getElementById("myChart").getContext("2d");if("fi"==selectedLang)var n=["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"];else if("en"==selectedLang)var n=["January","Fabruary","Mars","April","May","June","July","August","September","October","November","December"];else if("se"==selectedLang)var n=["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"];$(window).innerWidth()<=1366&&$(window).innerWidth()>=641?(r.canvas.width=345,r.canvas.height=170,t=10,a=30):$(window).innerWidth()<=640?(r.canvas.width=275,r.canvas.height=150,t=8,a=20):(r.canvas.width=420,r.canvas.height=290,t=12,a=30),myChart=new Chart(r,{type:"bar",data:{labels:n,datasets:e},options:{responsive:!1,maintainAspectRatio:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,fontSize:t}}],xAxes:[{ticks:{fontSize:t}}]},legend:{display:!0,labels:{fontSize:t,boxWidth:a,usePointStyle:!0,padding:10}}}})}function setImageUrl(e){var t=$(".notations");""===e&&t.attr("src","./")}function getVisibleLayerCount(){for(var e=0,t=map.getLayers().getArray(),a=0;a<t.length;a++){var r=t[a];1==r.getVisible()&&"base"!=r.getProperties().type&&e++}return e}function getVisibleLayers(){for(var e=[],t=map.getLayers().getArray(),a=0;a<t.length;a++){var r=t[a];1==r.getVisible()&&"base"!=r.getProperties().type&&e.push(r)}return e}function updeteDescriptionContent(){var e=getVisibleLayers(),t="";if(getVisibleLayerCount()>0){$("#descriptionLinks").html("<h2>Valitse selite tasolle</h2>");for(var a=0;a<e.length;a++){var r=e[a],n=r.getProperties().title,o=r.getProperties().visible;o&&setImageUrl(n.trim()),t=$("#descriptionLinks").html(),t+='<a href="#" onclick="setImageUrl(\''+n.trim()+"')\";return false;>"+n+"</a><br />",$("#descriptionLinks").html(t)}var i=$("#descriptionLinks").html();$("#descriptionLinks").html(i+"<hr>")}else $("#sideDescription").hide()}function changeLayerOpacity(e,t){var a=map.getLayers().getArray()[e];a.setOpacity(t)}function changeLayerVisibility(e,t){var a=map.getLayers().getArray()[e];if("base"==a.getProperties().type){a.setVisible(t);for(var r=map.getLayers().getArray(),n=0;n<r.length;n++){var o=r[n];"base"==o.getProperties().type&&o!=a&&o.setVisible(!1)}}else a.setVisible(t);updeteDescriptionContent()}function addLayersToSelect(e){for(var t=0;t<e.length;t++){var a=e[t].split(";"),r=a[0],n=a[1];$("#aineistoSelect").append($(document.createElement("option")).attr("value",n).text(r))}}function createLayerControls(){var e=["Valitse aineisto"],t=map.getLayers().getArray();console.log("layer count: "+t.length);for(var a=document.getElementById("contentMap").innerHTML,r=document.getElementById("contentBaseMap").innerHTML,n=0;n<t.length;n++){var o=t[n].getProperties(),i=o.name+"_opacity",l=o.name+"_visible";if(console.log(o.name),"base"===o.type)r+='<div class="baseMapRow '+l+'"><input name="basemap" class="baseM" checked="true" id="'+l+'" onchange="changeLayerVisibility('+n+',this.checked)" type="checkbox" data-toggle="toggleTwo" data-on="'+translator.getStr("lang_toggle_on")+'" data-off="'+translator.getStr("lang_toggle_off")+'">',r+=""+o.title+"</div>",r+='<div class="mapRowOpacity"><input title="'+translator.getStr("lang_transparency")+'" id="'+i+'" class="opacitySlider" max="1" min="0" default="1" oninput="changeLayerOpacity('+n+',this.value)"  step="0.1" type="range"></div>';else if("vectorLayerRoute"!==o.name){"vectorHeatmap"==o.name||"vectorLayer"!==o.name?(a+='<div class="mapRow"><input checked="true" class="status-check" id="'+l+'"  onchange="changeLayerVisibility('+n+',this.checked)" type="checkbox" data-toggle="toggleTwo" data-on="'+translator.getStr("lang_toggle_on")+'" data-off="'+translator.getStr("lang_toggle_off")+'">',a+=""+o.title+"</div>",a+='<div class="mapRowOpacity"><input title="'+translator.getStr("lang_transparency")+'" id="'+i+'" class="opacitySlider" max="1" min="0" default="1" oninput="changeLayerOpacity('+n+',this.value)"  step="0.1" type="range"></div>'):"vectorLayer"==o.name&&(a+='<div class="mapRow"><input checked="true" id="'+l+'"  onchange="changeLayerVisibility('+n+',this.checked)" type="checkbox" data-toggle="toggleTwo" data-on="'+translator.getStr("lang_toggle_on")+'" data-off="'+translator.getStr("lang_toggle_off")+'">',a+=""+o.title+"</div>",a+='<div class="mapRowOpacity"><input title="'+translator.getStr("lang_transparency")+'" id="'+i+'" class="opacitySlider" max="1" min="0" default="1" oninput="changeLayerOpacity('+n+',this.value)"  step="0.1" type="range"></div>');var s=""+o.title+";"+o.name;e.push(s)}}document.getElementById("contentMap").innerHTML=a,document.getElementById("contentBaseMap").innerHTML=r,addLayersToSelect(e)}function setLayerControlValues(){var e=map.getLayers().getArray();console.log("layer count: "+e.length);for(var t=0;t<e.length;t++){var a=e[t].getProperties(),r=a.name+"_opacity",n=a.name+"_visible";"vectorLayerRoute"!==a.name?(document.getElementById(r).value=e[t].getOpacity(),document.getElementById(n).checked=e[t].getVisible()):"vectorHeatmap"==a.name&&1==e[t].getVisible()&&(document.getElementById(r).value=e[t].getOpacity(),document.getElementById(n).checked=e[t].getVisible())}}function changeBasemapToggle(){$("#osm_dark_visible").change(function(){1==$(this).prop("checked")?($("#osm_light_visible").bootstrapToggle("off"),$("#osm_satellite_visible").bootstrapToggle("off"),osm_dark.setVisible(!0)):osm_dark.setVisible(!1)}),$("#osm_light_visible").change(function(){1==$(this).prop("checked")&&($("#osm_dark_visible").bootstrapToggle("off"),$("#osm_satellite_visible").bootstrapToggle("off")),osm_light.setVisible(!0)}),$("#osm_satellite_visible").change(function(){1==$(this).prop("checked")?($("#osm_light_visible").bootstrapToggle("off"),$("#osm_dark_visible").bootstrapToggle("off"),osm_satellite.setVisible(!0)):osm_satellite.setVisible(!1)})}function changeVectormapToggle(){$("#vectorHeatmap_visible").change(function(){1==$(this).prop("checked")?($("#vectorLayer_visible").bootstrapToggle("off"),vectorLayer.setVisible(!1),vectorHeatmap.setVisible(!0),zoomForBlur()):(vectorHeatmap.setVisible(!1),zoomForBlur())}),$("#vectorLayer_visible").change(function(){1==$(this).prop("checked")?($("#vectorHeatmap_visible").bootstrapToggle("off"),vectorLayer.setVisible(!0),vectorHeatmap.setVisible(!1),zoomForBlur()):vectorLayer.setVisible(!1)})}function searchContent(e,t,a){$("#searchContent").append("<div class='row'><div class='col-sm-3'><img id='rowImg' height='50' src='./img/marker-green_for_search.png' /></div><div class='col-sm-9' id='searchRow' coordinates='"+t+"' source='"+a+"'>"+e+"</div></div></div>")}function lineBuffer(e){function t(e,t){return e+t}(0==myChartBoolean||1==searchToggle)&&$("#previousSearch").show();var a=vectorSource.getFeatures();if(a.length>0){var r=polyline.decode(e),e=turf.lineString(r,{stroke:"#F00"}),n=turf.flip(turf.buffer(e,.05,"kilometers")),o=[];a.forEach(function(e){o.push(utils.to4326(e.getGeometry().getCoordinates()))});var i=turf.multiPoint(o),l=turf.intersect(n,i);if(null!=l.geometry){"Point"==l.geometry.type?sumArray.push(1):"MultiPoint"==l.geometry.type&&sumArray.push(l.geometry.coordinates.length);var s=sumArray.reduce(t);$("#myChartDivFooter2").empty(),$("#searchContent").html("<div id='accidentsOnRoute'><span style='font-size:2em;' class='glyphicon glyphicon-info-sign' aria-hidden='true'></span><br />"+translator.getStr("lang_route_ok")+s+translator.getStr("lang_route_kpl")+"</div>"),$("#myChartDivFooter2").append(translator.getStr("lang_route_ok")+s+translator.getStr("lang_route_kpl"))}else $("#searchContent").html("<div id='accidentsOnRoute'><span style='font-size:2em;' class='glyphicon glyphicon-info-sign' aria-hidden='true'></span><br />"+translator.getStr("lang_route_nodata")+"</div>");var i="",l="";routeOnline=1,$(".loading").hide(),msg_el.innerHTML=translator.getStr("route_added"),$("#msg").fadeTo(5e3,0)}else $("#searchContent").html("<div id='accidentsOnRoute' class='routelangNodata'><span style='font-size:2em;' class='glyphicon glyphicon-info-sign' aria-hidden='true'></span><br />"+translator.getStr("lang_route_nosearch")+"</div>")}$(document).ready(function(){"yes"!=sessionStorage.PopupShown&&($("#welcome").show(),$("#welcomeHeader").show(),$("#welcomeOverlay").show()),changeVectormapToggle(),changeBasemapToggle(),populateFormSelects(),$("#imageReferences").attr("src",translator.getStr("lang_header_logo")),$("#imageReferences2").attr("src",translator.getStr("lang_header_logo")),$('meta[name="description"]').replaceWith('<meta name="description" content="'+translator.getStr("lang_welcome_innercontent")+'">'),$("title").append(translator.getStr("index_header")),$("#closeWelcomeDiv").append(translator.getStr("lang_continue")),$("#welcomeHeader").append(translator.getStr("lang_welcome_header")),$("#welcomeInnerContent").append(translator.getStr("lang_welcome_innercontent")),$("#layerContentHeader").find("span").attr("title",translator.getStr("lang_navi_3")),$("#popupPanel-closerSideContentGraph").attr("title",translator.getStr("lang_navi_1")),$("#popupPanel-closerGraph").attr("title",translator.getStr("lang_navi_2")),$("#search_field").attr("placeholder",translator.getStr("lang_search_route1")),$("#analysisHeader").append(translator.getStr("index_header")),$("#analysisHeaderTextContent").append(translator.getStr("index_info_header")),$("#routeButton").append(translator.getStr("route_startbutton")),$("#lang_year").append(translator.getStr("lang_year")),$("#lang_month").append(translator.getStr("lang_month")),$("#lang_time_of_day").append(translator.getStr("lang_time_of_day")),$("#lang_stability").append(translator.getStr("lang_stability")),$("#lang_type").append(translator.getStr("lang_type")),$("#lang_partakers").append(translator.getStr("lang_partakers")),$("#reset").append(translator.getStr("lang_reset")),$("#submitButton").append(translator.getStr("lang_submit")),$("#hamburger_header1").append(translator.getStr("lang_hamburger_header1")),$("#hamburger_header2").append(translator.getStr("lang_hamburger_header2")),$("#layersHeader").append(translator.getStr("lang_layers_header")),$("#basemapsHeader").append(translator.getStr("lang_basemaps_header")),$("#informa1").append(translator.getStr("lang_menu_header_1")),$("#informa2").append(translator.getStr("lang_menu_header_2")),$("#informa3").append(translator.getStr("lang_menu_header_3")),$("#informa4").append(translator.getStr("lang_menu_header_4")),$("#information1").append(translator.getStr("lang_menu_content_1")),$("#information2").append(translator.getStr("lang_menu_content_2")),$("#information3").append(translator.getStr("lang_menu_content_3")),$("#information4").append(translator.getStr("lang_menu_content_4")),$("#closeWelcomeDiv").click(function(e){$("#welcome").hide(),$("#welcomeHeader").hide(),$("#welcomeOverlay").hide(),sessionStorage.PopupShown="yes"}),$("#layerContentHeader").click(function(){$("#layerContent").toggle(),$("#layerContent").is(":hidden")?(0==searchToggle&&($(window).innerWidth()<=1366?$("#layerContent").css("margin-top","47px"):$("#layerContent").css("margin-top","75px")),1==searchToggle&&$("#previousSearch").show(),1==chartToggle&&($("#myChartDiv").show(),$("#sideContentContentAnalysis").hide(),$("#previousSearch").hide()),1==myChartBoolean&&($("#myChartDiv").show(),$("#sideContentContentAnalysis").hide(),$("#previousSearch").hide()),1==sideContentAnalysisToggle&&$("#sideContentContentAnalysis").show(),0==sideContentAnalysisToggle&&$("#sideContentContentAnalysis").hide(),layerContentToggle=0):(1==searchToggle&&($(window).innerWidth()<=1366&&$(window).innerWidth()>640?$("#layerContent").css("margin-top","90px"):$(window).innerWidth()<=640?$("#layerContent").css("margin-top","90px"):$("#layerContent").css("margin-top","121px"),$("#myChartDiv").hide(),sideContentAnalysisToggle=0,chartToggle=0,$("#previousSearch").hide()),1==chartToggle&&($("#myChartDiv").hide(),$("#previousSearch").hide()),layerContentToggle=1,$("#sideContentContentAnalysis").hide()),$("#about").hide(),$(window).innerWidth()<640}),$("#popupPanel-closerGraph, #forward").click(function(){var e=vectorSource.getFeatures();e.length>0&&($("#myChart").show(),$("#myChartDiv").show(),$("#sideContentContentAnalysis").hide(),$("#layerContent").hide(),$(window).innerWidth()<=1366?$("#layerContent").css("margin-top","47px"):$("#layerContent").css("margin-top","75px"),$("#searchContent").hide(),myChartBoolean=1,chartToggle=1,searchToggle=0,layerContentToggle=0,sideContentAnalysisToggle=0,$("#search_field").val(""),$("#search_field_target").val(""),$("#search_route_target").hide(),$("#layerContent").css("padding-top","80px"),$("#previousSearch").hide(),$(window).innerWidth()<=1366&&$(window).innerWidth()>640?$("#sideContentAnalysisHeader").css("height","116px"):$(window).innerWidth()<=640?$("#sideContentAnalysisHeader").css("height","111px"):$("#sideContentAnalysisHeader").css("height","141px"),routeActive=!1,vectorSourceRoute.clear(),points=[]),$("#myChartDivFooter2").empty()}),$("#previousSearch").click(function(){var e=vectorSource.getFeatures();e.length>0?($("#myChart").show(),$("#myChartDiv").show(),$("#sideContentContentAnalysis").hide(),$("#layerContent").hide(),$(window).innerWidth()<=1366?$("#layerContent").css("margin-top","47px"):$("#layerContent").css("margin-top","75px"),$("#searchContent").hide(),myChartBoolean=1,chartToggle=1,searchToggle=0,layerContentToggle=0,sideContentAnalysisToggle=0,$("#search_field").val(""),$("#search_field_target").val(""),$("#search_route_target").hide(),$("#layerContent").css("padding-top","80px"),$("#previousSearch").hide(),$(window).innerWidth()<=1366&&$(window).innerWidth()>640?$("#sideContentAnalysisHeader").css("height","116px"):$(window).innerWidth()<=640?$("#sideContentAnalysisHeader").css("height","111px"):$("#sideContentAnalysisHeader").css("height","141px")):($("#msg").hide(),$("#myChart").hide(),$("#myChartDiv").hide(),$("#layerContent").hide(),$("#searchContent").hide(),$("#search_field").val(""),$("#search_field_target").val(""),$("#search_route_target").hide(),$(window).innerWidth()<=1366?$("#layerContent").css("margin-top","47px"):$("#layerContent").css("margin-top","75px"),$(window).innerWidth()<=1366&&$(window).innerWidth()>640?$("#sideContentAnalysisHeader").css("height","116px"):$(window).innerWidth()<=640?$("#sideContentAnalysisHeader").css("height","111px"):$("#sideContentAnalysisHeader").css("height","141px"),routeActive=!1,console.log("route "+routeActive),vectorSourceRoute.clear(),points=[],chartToggle=0,searchToggle=0,layerContentToggle=0,sideContentAnalysisToggle=1,myChartBoolean=0,$("#sideContentContentAnalysis").show(),$("#previousSearch").hide(),$("#sideContentContentAnalysis").css("padding-top","26px"))}),$("#headerLangSelectionEN").click(function(){window.location.search="?lang=en"}),$("#headerLangSelectionFI").click(function(){window.location.search="?lang=fi"}),$("#headerLangSelectionSE").click(function(){window.location.search="?lang=se"}),$("#popupPanel-closerSideContentAnalysis").click(function(){$("#sideContentAnalysis").hide()}),$("#popupPanel-closerSideContentGraph, #previous").click(function(){$("#msg").hide(),$("#myChart").hide(),$("#myChartDiv").hide(),$("#layerContent").hide(),$("#searchContent").hide(),$("#search_field").val(""),$("#search_field_target").val(""),$("#search_route_target").hide(),$(window).innerWidth()<=1366?$("#layerContent").css("margin-top","47px"):$("#layerContent").css("margin-top","85px"),$(window).innerWidth()<=1366&&$(window).innerWidth()>640?$("#sideContentAnalysisHeader").css("height","116px"):$(window).innerWidth()<=640?$("#sideContentAnalysisHeader").css("height","111px"):$("#sideContentAnalysisHeader").css("height","141px"),routeActive=!1,console.log("route "+routeActive),vectorSourceRoute.clear(),points=[],chartToggle=0,searchToggle=0,layerContentToggle=0,sideContentAnalysisToggle=1,myChartBoolean=0;var e=vectorSource.getFeatures();$("#sideContentContentAnalysis").show(),e.length>0?($("#forward").show(),$("#previousSearch").hide(),$("#sideContentContentAnalysis").css("padding-top","45px")):($("#forward").hide(),$("#previousSearch").hide(),$("#sideContentContentAnalysis").css("padding-top","26px")),$("#myChartDivFooter2").empty()}),$("#arrow-closerSideContentGraphHide").click(function(){$("#sideContentAnalysis").hide("slide",{direction:"left"},400),$("#myChartDiv").is(":visible")&&(myChartBoolean=1,chartToggle=1),$("#layerContentHeader").is(":visible"),$("#mapButtons").is(":visible")&&$("#mapButtons").animate({left:"-=38em"}),$("#arrow-closerSideContentGraphShow").css("transform","rotate(180deg)"),$("#arrow-closerSideContentGraphShow").delay(400).show(0),$("#arrow-closerSideContentGraphHide").hide()}),$("#arrow-closerSideContentGraphShow").click(function(){$("#myChart").show("slide",{direction:"left"},400),$("#sideContentAnalysis").show("slide",{direction:"left"},400),$("#layerContentHeader").show("slide",{direction:"left"},400),$("#mapButtons").is(":visible")&&$("#mapButtons").animate({left:"+=38em"}),$("#layerContentHeader").is(":visible"),$("#arrow-closerSideContentGraphShow").hide(),$("#arrow-closerSideContentGraphHide").delay(400).show(0)}),$("#sideContentAnalysis").show(),$("#sideContentAnalysisHeader").show(),$(window).innerWidth()<=1366?$("#slider3").roundSlider({sliderType:"range",value:"1,12",min:1,max:12,width:15,radius:60}):$("#slider3").roundSlider({sliderType:"range",value:"1,12",min:1,max:12});var e=["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],t=["January","Fabruary","Mars","April","May","June","July","August","September","October","November","December"],a=["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"];$("#slider3").change(function(){var r=$("#slider3").data("roundSlider");"fi"==selectedLang?($("#rsStart").empty(),$("#rsStart").append(e[r.getValue(1)-1]),$("#rsEnd").empty(),$("#rsEnd").append(e[r.getValue(2)-1])):"en"==selectedLang?($("#rsStart").empty(),$("#rsStart").append(t[r.getValue(1)-1]),$("#rsEnd").empty(),$("#rsEnd").append(t[r.getValue(2)-1])):"se"==selectedLang&&($("#rsStart").empty(),$("#rsStart").append(a[r.getValue(1)-1]),$("#rsEnd").empty(),$("#rsEnd").append(a[r.getValue(2)-1]))}),"fi"==selectedLang?($("#rsEnd").empty(),$("#rsStart").append(e[0]),$("#rsEnd").append(e[11])):"en"==selectedLang?($("#rsEnd").empty(),$("#rsStart").append(t[0]),$("#rsEnd").append(t[11])):"se"==selectedLang&&($("#rsEnd").empty(),$("#rsStart").append(a[0]),$("#rsEnd").append(a[11])),$("#search").on("submit",function(e){$("#sideContentContentAnalysis").hide(),$("#popupPanel-closerSideContentGraph").show(),$("#sideContentContentAnalysis").hide(),$("#myChartDiv").hide(),$("#searchContent").empty(),$("#searchContent").show(),$("#search_route_target").empty(),console.log($("#search_field").val()),layerContentToggle=0,searchToggle=1,myChartBoolean=0,$("#previousSearch").show(),$("#layerContent").hide(),$("#searchContent").append("<div id='searchContentContainer' class='container'>"),$.getJSON("https://api.mapbox.com/geocoding/v5/mapbox.places/"+$("#search_field").val()+".json?access_token=pk.eyJ1Ijoiam91a29qYXIiLCJhIjoiY2lvam1ubmVhMDA4Z3c0ajdleHl6ZjFtdSJ9.pbxTgzkFQJx-EMxxEJjSEA&country=fi&limit=10",function(e){$.each(e.features,function(e,t){searchContent(t.place_name,t.center,1)})}),$("#searchContent").append("</div>"),$("#search_route_target").show(),$(".input-group").clone().appendTo("#search_route_target").find("input[type='text']").val(""),$("#search_route_target").find("form").attr("id","search_target"),$("#search_route_target").find("input").attr("placeholder",translator.getStr("lang_search_route2")),$("#search_route_target").find("input").attr("id","search_field_target"),$(window).innerWidth()<=1366&&$(window).innerWidth()>640?$("#sideContentAnalysisHeader").css("height","156px"):$(window).innerWidth()<=640?$("#sideContentAnalysisHeader").css("height","150px"):$("#sideContentAnalysisHeader").css("height","193px"),e.preventDefault()}),$("#search_route_target").on("submit","#search_target",function(e){$("#sideContentContentAnalysis").hide(),$("#searchContent").empty(),console.log("joo"+$(this).val()),searchToggle=1,myChartBoolean=0,$("#layerContent").hide(),$("#searchContent").append("<div id='searchContentContainer' class='container'>"),$.getJSON("https://api.mapbox.com/geocoding/v5/mapbox.places/"+$("#search_field_target").val()+".json?access_token=pk.eyJ1Ijoiam91a29qYXIiLCJhIjoiY2lvam1ubmVhMDA4Z3c0ajdleHl6ZjFtdSJ9.pbxTgzkFQJx-EMxxEJjSEA&country=fi&limit=10",function(e){$.each(e.features,function(e,t){searchContent(t.place_name,t.center,2)})}),$("#searchContent").append("</div>"),e.preventDefault()}),$("#searchContent").on("click","#searchRow",function(){var e=[],t=$(this).attr("coordinates");e.push(t);var a=JSON.parse("["+e.join()+"]");1==$(this).attr("source")?$("#search_field").val($(this).text()):2==$(this).attr("source")&&$("#search_field_target").val($(this).text()),1==$(this).attr("source")&&(vectorSourceRoute.clear(),points=[]),initRoute(a,!0,!0),$("#searchContent").empty(),$("#search_field_target").focus()}),$("#target").on("submit",function(e){if(chartToggle=1,sideContentAnalysisToggle=0,null==$("#year").val())return $("#yearInfo").empty(),$("#yearInfo").show(),$("#yearInfo").append("<span style='font-size:2em;' class='glyphicon glyphicon-info-sign' aria-hidden='true'></span><br />"+translator.getStr("lang_select_years")),!1;var t=$("#slider3").data("roundSlider");$("#previous").show(),$("#yearInfo").hide(),changeParameter($("#year").val(),t.getValue(1),t.getValue(2),$("#vakavuus").val(),$("#tyyppi").val(),$("#aika").val(),$("#osalliset").val()),e.preventDefault()}),$("#success").click(function(){map.getView().setResolution(499);
}),$("#msg").click(function(){$("#msg").hide()}),$("#search_field").click(function(){$("#msg").css({opacity:1}),sumArray=[],$("#searchContent").empty(),$(window).innerWidth()<=1024&&$(window).innerWidth()>=768?$("#success").is(":visible")?$("#msg").css("margin-top","68px"):$("#msg").css("margin-top","1px"):$(window).innerWidth()<=640?$("#success").is(":visible")?$("#msg").css("bottom","10px"):$("#msg").css("bottom","-48px"):$("#success").is(":visible")?$("#msg").css("margin-top","67px"):$("#msg").css("margin-top","0px"),$("#msg").show(),$("#msg").html(""),$("#msg").append(translator.getStr("route_startpoint")),vectorSourceRoute.clear(),points=[],$("#routeButton").html(""),$("#routeButton").append(translator.getStr("route_stopbutton")),routeActive=!0}),$("#routeButton").click(function(){1==routeActive?($("#routeButton").html(""),$("#routeButton").append(translator.getStr("route_startbutton")),vectorSourceRoute.clear(),points=[],routeActive=!1,$("#msg").hide()):($("#msg").show(),$("#msg").html(""),$("#msg").append(translator.getStr("route_startpoint")),vectorSourceRoute.clear(),points=[],$("#routeButton").html(""),$("#routeButton").append(translator.getStr("route_stopbutton")),routeActive=!0)}),$("#year").multiselect({includeSelectAllOption:!0,buttonWidth:424,numberDisplayed:6,allSelectedText:!1,nSelectedText:translator.getStr("nSelectedText"),selectAllText:translator.getStr("selectAllText"),nonSelectedText:translator.getStr("nonSelectedTextNotSelected")}),$("#aika").multiselect({includeSelectAllOption:!0,buttonWidth:424,numberDisplayed:3,allSelectedText:!1,nSelectedText:translator.getStr("nSelectedText"),selectAllText:translator.getStr("selectAllText"),nonSelectedText:translator.getStr("nonSelectedTextAll")}),$("#vakavuus").multiselect({includeSelectAllOption:!0,buttonWidth:424,numberDisplayed:2,allSelectedText:!1,nSelectedText:translator.getStr("nSelectedText"),selectAllText:translator.getStr("selectAllText"),nonSelectedText:translator.getStr("nonSelectedTextAll")}),$("#tyyppi").multiselect({includeSelectAllOption:!0,buttonWidth:424,numberDisplayed:2,allSelectedText:!1,nSelectedText:translator.getStr("nSelectedText"),selectAllText:translator.getStr("selectAllText"),nonSelectedText:translator.getStr("nonSelectedTextAll")}),$("#osalliset").multiselect({includeSelectAllOption:!0,buttonWidth:424,numberDisplayed:2,allSelectedText:!1,nSelectedText:translator.getStr("nSelectedText"),selectAllText:translator.getStr("selectAllText"),nonSelectedText:translator.getStr("nonSelectedTextAll")}),$("#reset").click(function(){console.log(selectedLang),"fi"==selectedLang?$(".multiselect-selected-text").attr("title","Ei valittuja").html("Ei valittuja"):"en"==selectedLang&&$(".multiselect-selected-text").attr("title","Not selected").html("Not selected"),$(".multiselect-container li").removeClass("active"),$("#yearInfo").hide();var a=$("#slider3").data("roundSlider");a.setValue("1,12"),$("#rsStart").empty(),$("#rsEnd").empty(),"fi"==selectedLang?($("#rsStart").append(e[0]),$("#rsEnd").append(e[11])):"en"==selectedLang&&($("#rsStart").append(t[0]),$("#rsEnd").append(t[11]))}),"?lang=fi"==location.search||"?lang=en"==location.search||"?lang=se"==location.search||("fi"==navigator.language||"fi-FI"==navigator.language||"fi-fi"==navigator.language?location.replace("?lang=fi"):"se"==navigator.language?location.replace("?lang=se"):"en"==navigator.language&&location.replace("?lang=en"))});var myChartBoolean=0,chartToggle=0,searchToggle=0,layerContentToggle=0,sideContentAnalysisToggle=1,query=getQueryParams(document.location.search),selectedLang=query.lang,translator=new Language(selectedLang),format=new ol.format.GeoJSON,cqlFilter=[],years=[],urlTemplate,cleared=!1,url="",attribution_taustakartta=new ol.Attribution({html:"Tieliikenneonnettomuudet © Tilastokeskus,"}),iconStyle=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,40],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"http://cdn.leafletjs.com/leaflet/v1.0.0-beta.2/images/marker-icon.png"})}),circle_one=new ol.style.Style({image:new ol.style.Circle({radius:20,fill:new ol.style.Fill({color:"rgba(67, 107, 168, 0.6)"})}),text:new ol.style.Text({font:'12px "Helvetica Neue", Arial, Helvetica, sans-serif',text:"",fill:new ol.style.Fill({color:"#000"})})}),circle1=new ol.style.Style({image:new ol.style.Circle({radius:20,fill:new ol.style.Fill({color:"rgba(8,69,148, 0.6)"})}),text:new ol.style.Text({font:'12px "Helvetica Neue", Arial, Helvetica, sans-serif',text:"",fill:new ol.style.Fill({color:"#000"})})}),circle2=new ol.style.Style({image:new ol.style.Circle({radius:20,fill:new ol.style.Fill({color:"rgba(33,113,181, 0.6)"})}),text:new ol.style.Text({font:'12px "Helvetica Neue", Arial, Helvetica, sans-serif',text:"",fill:new ol.style.Fill({color:"#000"})})}),circle3=new ol.style.Style({image:new ol.style.Circle({radius:20,fill:new ol.style.Fill({color:"rgba(66,146,198, 0.6)"})}),text:new ol.style.Text({font:'12px "Helvetica Neue", Arial, Helvetica, sans-serif',text:"",fill:new ol.style.Fill({color:"#000"})})}),circle4=new ol.style.Style({image:new ol.style.Circle({radius:20,fill:new ol.style.Fill({color:"rgba(107,174,214, 0.6)"})}),text:new ol.style.Text({font:'12px "Helvetica Neue", Arial, Helvetica, sans-serif',text:"",fill:new ol.style.Fill({color:"#000"})})}),circle5=new ol.style.Style({image:new ol.style.Circle({radius:20,fill:new ol.style.Fill({color:"rgba(158,202,225, 0.6)"})}),text:new ol.style.Text({font:'12px "Helvetica Neue", Arial, Helvetica, sans-serif',text:"",fill:new ol.style.Fill({color:"#000"})})}),points=[],msg_el=document.getElementById("msg"),url_osrm_nearest="http://router.project-osrm.org/nearest/v1/driving/",url_osrm_route="http://router.project-osrm.org/route/v1/driving/",icon_url="https://www.webigu.fi/tlonnettomuudet/img/marker-green.png",url_mapbox_nearest="https://api.mapbox.com/geocoding/v5/mapbox/places/",url_mapbox_route="https://api.mapbox.com/directions/v5/mapbox/driving/",vectorSourceRoute=new ol.source.Vector,vectorLayerRoute=new ol.layer.Vector({source:vectorSourceRoute,name:"vectorLayerRoute",title:"Route"}),styles={route:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:[0,115,176,.8]})}),icon:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,.6],src:icon_url})})},vectorLayer=new ol.layer.Vector({source:new ol.source.Vector({attributions:[attribution_taustakartta]}),title:translator.getStr("lang_cluster"),name:"vectorLayer",style:createClusterIcon}),vectorHeatmap=new ol.layer.Heatmap({source:new ol.source.Vector({attributions:[attribution_taustakartta]}),title:translator.getStr("lang_heatmap"),name:"vectorHeatmap",maxResolution:500,visible:!1,gradient:get_gradient()}),extent3067=[-548576,6291456,1548576,8388608],projection=new ol.proj.Projection({code:"EPSG:3067",extent:extent3067,units:"m"});ol.proj.addProjection(projection);for(var projectionExtent=projection.getExtent(),size=ol.extent.getWidth(projectionExtent)/256,resolutions=new Array(16),matrixIds=new Array(16),matrixIdsMML=new Array(16),z=0;16>z;++z)resolutions[z]=size/Math.pow(2,z),matrixIds[z]="EPSG:3067:"+z,matrixIdsMML[z]=z,console.log(matrixIdsMML[z]);var osm_light=new ol.layer.Tile({source:new ol.source.OSM({attributions:['&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CARTO</a>'],url:"//cartodb-basemaps-b.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png"}),title:translator.getStr("lang_light_bgmap"),visible:!0,name:"osm_light",type:"base"}),osm_dark=new ol.layer.Tile({source:new ol.source.XYZ({url:"https://api.mapbox.com/styles/v1/joukojar/ciwpd449y00a52pnvvbuytfn7/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1Ijoiam91a29qYXIiLCJhIjoiY2lvam1ubmVhMDA4Z3c0ajdleHl6ZjFtdSJ9.pbxTgzkFQJx-EMxxEJjSEA",attributions:['© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>']}),title:translator.getStr("lang_dark_bgmap"),visible:!1,name:"osm_dark",type:"base"}),attribution_taustakartta=new ol.Attribution({html:"Taustakartta (c) MML, 2017"}),taustakartta_ETRS_TM35FIN_wmts_layer=new ol.layer.Tile({title:"Taustakartta (MML)",name:"Taustakartta (MML)",opacity:1,visible:!0,type:"base",source:new ol.source.WMTS({attributions:[attribution_taustakartta],url:"http://avoindata.maanmittauslaitos.fi/mapcache/wmts/",layer:"taustakartta",matrixSet:"ETRS-TM35FIN",format:"image/png",transitionEffect:"resize",gutter:0,buffer:0,projection:"EPSG:3067",tileGrid:new ol.tilegrid.WMTS({origin:ol.extent.getTopLeft(projectionExtent),resolutions:resolutions,matrixIds:matrixIdsMML}),style:"default"})}),container=document.getElementById("popup"),content=document.getElementById("popup-content"),closer=document.getElementById("popup-closer"),overlay=new ol.Overlay({element:container,autoPan:!0,autoPanAnimation:{duration:250}}),scaleLineControl=new ol.control.ScaleLine;closer.onclick=function(){return overlay.setPosition(void 0),closer.blur(),!1};var centerX,centerY;$(window).innerWidth()<=1366?(centerX=2503635,centerY=9081277):(centerX=2503635,centerY=9551277);var layers=[osm_light,osm_dark,vectorLayer,vectorHeatmap,vectorLayerRoute],map=new ol.Map({controls:ol.control.defaults().extend([new ol.control.ScaleLine({target:document.getElementById("scale-line")})]),layers:layers,target:"map",overlays:[overlay],view:new ol.View({center:[centerX,centerY],zoom:6,minZoom:6,maxZoom:18})}),displayFeatureInfo=function(e){var t="";map.forEachFeatureAtPixel(e,function(e){console.log("chart "+myChartBoolean),e.get("vvonn")>0&&(t='<div id="popup_header">'+translator.getStr("lang_gfi_header")+'</div><div id="popup_inner_content"><table><!--<tr><td>Id: </td><td>'+e.get("id")+"</td></tr>--><tr><td>"+translator.getStr("lang_gfi_year")+" </td><td>"+e.get("vvonn")+"</td></tr><tr><td>"+translator.getStr("lang_gfi_month")+" </td><td>"+e.get("kkonn")+"</td></tr><tr><td>"+translator.getStr("lang_gfi_td")+" </td><td>"+e.get("kello")+"</td></tr><tr><td>"+translator.getStr("lang_gfi_stability")+" </td><td>"+stability(parseInt(e.get("vakav")))+"</td></tr><tr><td>"+translator.getStr("lang_gfi_toa")+" </td><td>"+typeCodes(parseInt(e.get("onntyyppi")))+"</td></tr><tr><td>"+translator.getStr("lang_gfi_party1")+" </td><td>"+e.get("lkmhapa")+"</td></tr><tr><td>"+translator.getStr("lang_gfi_party2")+" </td><td>"+e.get("lkmlaka")+"</td></tr><tr><td>"+translator.getStr("lang_gfi_party3")+" </td><td>"+e.get("lkmjk")+"</td></tr><tr><td>"+translator.getStr("lang_gfi_party4")+" </td><td>"+e.get("lkmpp")+"</td></tr><tr><td>"+translator.getStr("lang_gfi_party5")+" </td><td>"+e.get("lkmmo")+"</td></tr><tr><td>"+translator.getStr("lang_gfi_party6")+" </td><td>"+e.get("lkmmp")+"</td></tr><tr><td>"+translator.getStr("lang_gfi_party7")+" </td><td>"+e.get("lkmmuukulk")+"</td></tr></table></div>")});return t};map.on("singleclick",function(e){var t=e.coordinate;ol.coordinate.toStringHDMS(ol.proj.transform(t,"EPSG:3857","EPSG:4326"));console.log(displayFeatureInfo(e.pixel)),displayFeatureInfo(e.pixel).length>0&&(content.innerHTML=displayFeatureInfo(e.pixel),overlay.setPosition(t))});var routeActive="false";map.on("click",function(e){console.log("route = "+routeActive),layerContentToggle=0,initRoute(e,!1,routeActive)});var utils={getNearest:function(e){var t=utils.to4326(e);return new Promise(function(e,a){fetch(url_mapbox_nearest+t.join()+".json?access_token=pk.eyJ1Ijoiam91a29qYXIiLCJhIjoiY2lvam1ubmVhMDA4Z3c0ajdleHl6ZjFtdSJ9.pbxTgzkFQJx-EMxxEJjSEA").then(function(e){return console.log(e.json()),e.json()}).then(function(t){"Ok"===t.code?e(t.waypoints[0].location):a()})})},createFeature:function(e){var t=new ol.Feature({type:"place",geometry:new ol.geom.Point(ol.proj.fromLonLat(e))});console.log(e),t.setStyle(styles.icon),vectorSourceRoute.addFeature(t)},createRoute:function(e){var t=new ol.format.Polyline({factor:1e5}).readGeometry(e,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),a=new ol.Feature({type:"route",geometry:t});a.setStyle(styles.route),vectorSourceRoute.addFeature(a);var r=vectorLayerRoute.getSource().getExtent();map.getView().fit(r,map.getSize()),lineBuffer(e)},to4326:function(e){return ol.proj.transform([parseFloat(e[0]),parseFloat(e[1])],"EPSG:3857","EPSG:4326")},to3857:function(e){return ol.proj.transform([parseFloat(e[0]),parseFloat(e[1])],"EPSG:4326","EPSG:3857")}};map.on("moveend",zoomForBlur);var worker=new Worker("javascripts/worker.js"),clusterSource=vectorLayer.getSource(),vectorSource=vectorHeatmap.getSource(),ready=!1;worker.onmessage=function(e){if(e.data.ready){ready=!0,update(),vectorSource.clear(!0);var t={type:"FeatureCollection",features:e.data.dataPoint},a=format.readFeatures(t,{featureProjection:"EPSG:3857"});yearArray=[],initChart(t,e.data.years),vectorSource.addFeatures(a),$(".loading").hide()}else{clusterSource.clear(!0);var r={type:"FeatureCollection",features:e.data.dataCluster},n=format.readFeatures(r,{featureProjection:"EPSG:3857"});clusterSource.addFeatures(n)}},map.on("moveend",update);var monthArray=[],monthArray2=[],myChart="",yearArray=[],sumTotal=[],properties;createLayerControls(),setLayerControlValues();var sumArray=[],routeOnline=0;